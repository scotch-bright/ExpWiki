<!DOCTYPE html>
<html>
	<head>
		<title>Bubble Sort Demo :: By Khoj Badami</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<style type="text/css">

			.table {
				background-color: white;
			}

			tr {
				background-color: white;
				transition: background-color 0.5s ease-out;
			}

			tr.updated {
				background-color: #FDD437;
			}

			.bubble {
				border-radius: 50%;
				box-shadow: 0 20px 30px rgba(0, 0, 0, 0.2), inset 0px 10px 30px 5px rgba(255, 255, 255, 1);
			    height: 70px;
				width: 70px;
				position: absolute;
				color: white;
				transition: color 0.5s ease-out;
			}

			.bubble.active {
				box-shadow:
				    inset 0 0 50px #fff,
				    inset 20px 0 80px #f0f,
				    inset -20px 0 80px #0ff,
				    inset 20px 0 300px #f0f,
				    inset -20px 0 300px #0ff,
				    0 0 50px #fff,
				    -10px 0 80px #f0f,
				    10px 0 80px #0ff;
			}

			.bubble.sorted {
				color: #00ff4e;
			}

			.bubble:after {
			    background: radial-gradient(ellipse at center,  rgba(255,255,255,0.5) 0%,rgba(255,255,255,0) 70%);
			    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#80ffffff', endColorstr='#00ffffff',GradientType=1 );
				border-radius: 50%;
				box-shadow: inset 0 20px 30px rgba(255, 255, 255, 0.3);				
				content: "";
			    height: 50px;
				left: 10px;
				width: 50px;
			}

			.number_holder {
				display: flex;
			    width: 100%;
			    height: 100%;
			    justify-content: center;
			    align-items: center;
			    font-weight: bold;
			    font-size: 25px;
			}

			body {
				background: #00b4ff;
			}
		</style>
	</head>
	<body>
		<div class="container mt-3 mb-3">
			<div class="row">
				<div class="col-sm-12 text-center text-white">
					<h1>Bubble Sort</h1>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="row">
				<div class="col-sm-12">
					<form class="mt-2" id="input_form">
						<div class="form-group">
							<div class="input-group">
							  <div class="input-group-prepend">
							    <span class="input-group-text">
							    	The Numbers To Be Sorted
							    </span>
							  </div>
							  <input type="number" class="form-control" value="3" name="0" id="input_number_0">
							  <input type="number" class="form-control" value="-2" name="1" id="input_number_1">
							  <input type="number" class="form-control" value="15" name="2" id="input_number_2">
							  <input type="number" class="form-control" value="150" name="3" id="input_number_3">
							  <input type="number" class="form-control" value="42" name="4" id="input_number_4">
							  <input type="number" class="form-control" value="0" name="5" id="input_number_5">
							</div>
						</div>
						<div class="form-group form-check">
						    <input type="checkbox" class="form-check-input" id="optimize">
						    <label class="form-check-label text-white font-weight-bold" for="optimize">
						    	Optimize bubble sort!
						    </label>
						</div>
						<button type="submit" class="btn btn-danger" id="calculate_button">Sort!</button>
					</form>
				</div>
			</div>
		</div>

		<div class="container">
			<div class="row" style="min-height: 600px;">
				<div class="col-sm-4 mt-3" style="position: relative;" id="bubbles_holder">
				</div> 
				<div class="col-sm-8 mt-3 text-white">
					<div class="text-center mb-3">
						<button class="btn btn-warning btn-lg" type="button" id="pause_button">Pause <i class="fa fa-pause"></i></button>
						<button class="btn btn-warning btn-lg" type="button" id="play_button">Play <i class="fa fa-play-circle"></i></button>
					</div>
					<table class="table">
						<thead class="thead-dark">
							<tr>
								<th>
									Input
								</th>
								<th>
									Number Of Comparisons
								</th>
								<th>
									Mode (Optimized / Normal)
								</th>
							</tr>
						</thead>
						<tbody id="number_of_operations">
						</tbody>
					</table>
					<div class="text-center mt-5">
						<h3>Explanation & How To Play With This..</h3>
						<iframe width="560" height="315" src="https://www.youtube.com/embed/RGueuVGF9Bs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
					</div>
				</div>
			</div>
		</div>


		<div class="modal fade" id="pleaseSeeOnALargerScreen" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="exampleModalLabel">Please see on a larger screen!</h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		        This demo cannot really be appreciated on a small screen.
		        <br />
		        Please see it on a larger screen. ðŸ˜€
		      </div>
		    </div>
		  </div>
		</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.6/gsap.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	<script type="text/javascript">

		var currentAnimationStep = 0;
		var animationRunning = false;
		var arrayOfAnimationSteps = [];

		function playAnimation() {
			$("#play_button").attr('disabled', true);
			$("#pause_button").attr('disabled', false);
			animationRunning = true;
			runAnimation();
		}

		function pauseAnimation() {
			animationRunning = false;
			$("#play_button").attr('disabled', false);
			$("#pause_button").attr('disabled', true);
		}

		function sleep(ms) {
		  return new Promise(resolve => setTimeout(resolve, ms));
		}

		function updateResultsTable(originalArray, numberOfComparisions, optimized) {
			let rowId = originalArray.join("-") + `${optimized ? 'Optimized' : 'Normal'}`;
			let rowSelector = "table #" + rowId;
			if ($(rowSelector).length == 0) {
				$("#number_of_operations").append(
					`
					<tr id="${rowId}">
						<td>[${originalArray.toString()}]</td>
						<td>${numberOfComparisions}</td>
						<td>${optimized ? 'Optimized' : 'Normal'}</td>
					</tr>
					`
				);
			}
			else {
				$(rowSelector).html(
					`
					<td>[${originalArray.toString()}]</td>
					<td>${numberOfComparisions}</td>
					<td>${optimized ? 'Optimized' : 'Normal'}</td>
					`
				);	
			}
			$(rowSelector).addClass('updated');
			setTimeout(() => { 
				$(rowSelector).removeClass('updated');
			}, 1000);
		}

		async function runAnimation() {
			await sleep(1000);

			for (i = currentAnimationStep; i < arrayOfAnimationSteps.length; i++) {
				if (animationRunning == false) { break; }
				let animationStep = arrayOfAnimationSteps[i];
				animationStep.play();
				currentAnimationStep = i;
				await sleep(2200);
			}
		}

		function NoSwapAnimationStep(pointerPostion, originalArray, numberOfComparisions, optimized) {
			this.pointerPostion = pointerPostion;
			this.originalArray = originalArray;
			this.numberOfComparisions = numberOfComparisions;
			this.play = () => {
				// Mark then active
				markBubbleActive(this.pointerPostion);
				markBubbleActive(this.pointerPostion + 1);

				// Get selectors & new tops
				let firstBubbleSelector = `#number_${pointerPostion}`;
				let secondBubbleSelector = `#number_${pointerPostion + 1}`;

				new Audio('./success.mp3').play();

				$(firstBubbleSelector).addClass('sorted');
				$(secondBubbleSelector).addClass('sorted');

				setTimeout(() => { 
					$(firstBubbleSelector).removeClass('sorted');
					$(secondBubbleSelector).removeClass('sorted');
					markBubbleInActive(this.pointerPostion);
					markBubbleInActive(this.pointerPostion + 1);
					updateResultsTable(this.originalArray, this.numberOfComparisions, optimized);
				}, 2000);
			}
		}

		function SwapAnimationStep(startingArray, pointerPositionToSwapAt, originalArray, numberOfComparisions, optimized) {
			this.startingArray = startingArray;
			this.pointerPositionToSwapAt = pointerPositionToSwapAt;
			this.originalArray = originalArray;
			this.numberOfComparisions = numberOfComparisions;

			this.play = () => {
				setUpBallsAsPerInputArray(this.startingArray);
				
				// Mark then active
				markBubbleActive(this.pointerPositionToSwapAt);
				markBubbleActive(this.pointerPositionToSwapAt + 1);

				// Get selectors & new tops
				let firstBubbleSelector = `#number_${this.pointerPositionToSwapAt}`;
				let secondBubbleSelector = `#number_${this.pointerPositionToSwapAt + 1}`;
				
				new Audio('./bubble.mp3').play()

				let firstTop = $(firstBubbleSelector).css('top');
				let secondTop = $(secondBubbleSelector).css('top');

				let firstVal = this.startingArray[this.pointerPositionToSwapAt];
				let secondVal = this.startingArray[this.pointerPositionToSwapAt + 1];

				this.startingArray[this.pointerPositionToSwapAt] = secondVal;
				this.startingArray[this.pointerPositionToSwapAt + 1] = firstVal;

				// Animate
				gsap.to(firstBubbleSelector, {
					top: secondTop,
					ease: "elastic.out(1, 0.3)",
					duration: 2
				});
				gsap.to(secondBubbleSelector, {
					top: firstTop,
					ease: "elastic.out(1, 0.3)",
					duration: 2,
					onComplete: () => {
						markBubbleInActive(this.pointerPositionToSwapAt);
						markBubbleInActive(this.pointerPositionToSwapAt + 1);
						setUpBallsAsPerInputArray(this.startingArray);
						updateResultsTable(this.originalArray, this.numberOfComparisions, optimized);
					}
				});
			}
		}

		function sortInputArrayUsingBubbleSortAndMakeAnimationSteps(inputArray, optimized) {
			let originalArray = [...inputArray];
			arrayOfAnimationSteps = [];
			let numberOfComparisions = 0;
			let lengthOfInputArray = inputArray.length;
			let reachedEndAndThereWereNoSwaps = false;

			let last_index = lengthOfInputArray - 1;

			while (reachedEndAndThereWereNoSwaps != true) {
				let wasThereASwap = false;
				for (pointerPostion = 0; pointerPostion < last_index; pointerPostion++) {
					let elementAtPointer = inputArray[pointerPostion];
					let nextElement = inputArray[pointerPostion + 1];
					numberOfComparisions += 1;
					if (elementAtPointer > nextElement) {
						wasThereASwap = true;
						arrayOfAnimationSteps.push(
							new SwapAnimationStep([...inputArray], pointerPostion, originalArray, numberOfComparisions, optimized)
						);
						inputArray[pointerPostion] = nextElement;
						inputArray[pointerPostion + 1] = elementAtPointer;
					}
					else {
						arrayOfAnimationSteps.push(
							new NoSwapAnimationStep(pointerPostion, originalArray, numberOfComparisions, optimized)
						);
					}
				}

				if (optimized) {
					last_index -= 1;
				}

				if (wasThereASwap == false) {
					reachedEndAndThereWereNoSwaps = true;
				}
			}
			currentAnimationStep = 0;
			playAnimation();
		}

		$( document ).ready(function() {

			if (screen.width < 768) {
				$("#pleaseSeeOnALargerScreen").modal();
			}

			$("#pause_button").click(
				function () {
					pauseAnimation();
				}
			);

			$("#play_button").click(
				function () {
					playAnimation();
				}
			);

			$("#input_form").submit(
				function(event) {
					event.preventDefault();
					inputArray = $(this).serializeArray().map(
						(input) => parseInt(input.value)
					);
					setUpBallsAsPerInputArray(inputArray);
					sortInputArrayUsingBubbleSortAndMakeAnimationSteps(inputArray, $('#optimize').is(":checked"));
				}
			);

		});

		function setUpBallsAsPerInputArray(inputArray) {
			let htmlOfBubbles = inputArray.map(
				(input, idx) => {
					return `<div class="bubble" style="top: calc(${idx} * 90px);" id="number_${idx}">
						<div class="number_holder">
							${input}
						</div>
					</div>`
				}
			).join("");
			$("#bubbles_holder").html(htmlOfBubbles);
		}

		function markBubbleActive(index) {
			$(`#number_${index}`).addClass('active');
		}

		function markBubbleInActive(index) {
			$(`#number_${index}`).removeClass('active');
		}

	</script>
	</body>
</html>