<!DOCTYPE html>
<html>
<head>
	<title>Merge Sort :: A Visual Demo By Khoj Badami</title>
	<style type="text/css">
		canvas {
			border: 1px solid lightgrey;
		}
	</style>
</head>
<body>
	<script src="./libs/jquery-3.5.1.min.js"></script>
	<script src="./libs/matter.min.js"></script>
	<script src="./libs/decomp.min.js"></script>
	<script src="./libs/path-data-polyfill.js"></script>
	<script type="text/javascript">

		let allBodies = {}

		function bodyFromSvgPathMaker(svgPath, x, y, name) {
			this.svgPath = svgPath;
			
			this.x = x;
			
			this.y = y;

			this.name = name;
			
			this.getColor = (path) => {
				let styleValue = $(path).attr("style");
				let fillProperty = styleValue.split(";").find(
					( property ) => {
						return property.split(":")[0] == 'fill';
					}
				);
				return fillProperty.split(":")[1];
			}
			
			this.makeBody = () => {
				let vertexSets = [];
				let points = Svg.pathToVertices(this.svgPath, 30);
				vertexSets.push(Vertices.scale(points, 3.77, 3.77));
				let body = Bodies.fromVertices(
					0, 0,
					vertexSets,
					{
	                    render: {
	                        fillStyle: this.getColor(this.svgPath),
	                        strokeStyle: this.getColor(this.svgPath),
	                        lineWidth: 1
	                    },
	                    isStatic : true
                    },
                    true
				);

				Matter.Body.setPosition(body, {
					x: this.x,
					y: this.y
				});

				let translationVector = Vector.sub(body.position, body.bounds.min);
				Matter.Body.translate(body, translationVector);

				allBodies[this.name] = body;
				return body;
			}
		}

		let Engine = Matter.Engine,
		    Render = Matter.Render,
		    World = Matter.World,
		    Bodies = Matter.Bodies,
		    Svg = Matter.Svg,
		    Vertices = Matter.Vertices,
		    Common = Matter.Common,
		    Vector = Matter.Vector;
		     
		let engine = Engine.create();
		 
		let render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: 1028,
                height: 1859,
                wireframes: false,
                background: '#ffffff'
            }
        });

		$.get( "./merge-sort-resources/static.svg", function( data ) {
			$(data).find('path').each(function(i, path) {
				let fullID = $(path).attr("id");
				let objectName = fullID.split("_")[0];
				let objectX = fullID.split("_")[1];
				let objectY = fullID.split("_")[2];
				let bodyMaker = new bodyFromSvgPathMaker(
					path, 
					parseFloat(objectX),
					parseFloat(objectY),
					objectName
				);
				World.add(engine.world, bodyMaker.makeBody());
			});
		});

        Engine.run(engine);
		Render.run(render);

	</script>
</body>
</html>