<!DOCTYPE html>
<html>
<head>
	<title>Matter JS PlayGround</title>
</head>
<body>
	<h1>Merge Sort Visulization Worn In Progress</h1>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.14.2/matter.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/poly-decomp@0.2.1/build/decomp.min.js"></script>
	<script type="text/javascript">
		
		let allBodies = {};
		let currentIndexOfActionWhenBodiesStopMoving = 0;

		// module aliases
		var Engine = Matter.Engine,
		    Render = Matter.Render,
		    World = Matter.World,
		    Bodies = Matter.Bodies;

		// create an engine
		var engine = Engine.create();

		// create a renderer
		var render = Render.create({
		    element: document.body,
		    engine: engine,
		    options: {
		    	width: 1000,
		    	height: 600,
		    	background: '#ffffff'
		    }
		});

		let arrayOfStaticObjectsPaths = [
			{
				name: 'level1Traiange',
				points: "500.000,83.443 724.777,235.923 275.223,235.923",
				width: 449.554,
				height: 152.480,
				x: 275.223,
				y: 83.443
			},
			{
				name: 'level2Platform1',
				points: "145.313,235.923 275.223,235.923 275.223,243.584 145.313,243.584",
				width: 129.910,
				height: 7.661,
				x: 145.313,
				y: 235.923
			},
			{
				name: 'level2Stopper1',
				points: "105.627,203.898 145.313,203.898 145.313,243.584 105.627,243.584",
				width: 39.686,
				height: 39.686,
				x: 105.627,
				y: 203.898
			},
			{
				name: 'level2Platform2',
				points: "724.777,235.923 854.687,235.923 854.687,243.584 724.777,243.584",
				width: 129.910,
				height: 7.661,
				x: 724.777,
				y: 235.923
			},
			{
				name: 'level2Stopper2',
				points: "854.687,203.898 894.373,203.898 894.373,243.584 854.687,243.584",
				width: 39.686,
				height: 39.686,
				x: 854.687,
				y: 203.898
			},
			{
				name: 'level2Traiange1',
				points: "182.907,257.659 295.296,356.945 70.519,356.945",
				width: 224.777,
				height: 99.286,
				x: 70.519,
				y: 257.659 + 20
			},
			{
				name: 'level2Traiange2',
				points: "817.377,257.659 929.766,356.945 704.988,356.945",
				width: 224.777,
				height: 99.286,
				x: 704.988,
				y: 257.659 + 20
			},
			{
				name: 'level3Platform1',
				points: "23.009,356.945 70.519,356.945 70.519,364.606 23.009,364.606 23.009,356.945",
				width: 47.510,
				height: 7.661,
				x: 23.009,
				y: 356.945 + 10
			},
			{
				name: 'level3Stopper1',
				points: "-16.677,324.920 23.009,324.920 23.009,364.606 -16.677,364.606 -16.677,324.920",
				width: 39.686,
				height: 39.686,
				x: -16.677,
				y: 324.920 + 10
			},
			{
				name: 'level3Platform2',
				points: "295.296,356.945 380.006,356.945 380.006,364.606 295.296,364.606 295.296,356.945",
				width: 84.710,
				height: 7.661,
				x: 295.296,
				y: 356.945 + 10
			},
			{
				name: 'level3Stopper2',
				points: "380.006,324.920 419.692,324.920 419.692,364.606 380.006,364.606 380.006,324.920",
				width: 39.686,
				height: 39.686,
				x: 380.006,
				y: 324.920 + 10
			},
			{
				name: 'level3Platform3',
				points: "620.278,356.945 704.988,356.945 704.988,364.606 620.278,364.606 620.278,356.945",
				width: 84.710,
				height: 7.661,
				x: 620.278,
				y: 356.945 + 10
			},
			{
				name: 'level3Stopper3',
				points: "580.592,324.920 620.278,324.920 620.278,364.606 580.592,364.606 580.592,324.920",
				width: 39.686,
				height: 39.686,
				x: 580.592,
				y: 324.920 + 10
			}
		];

		let actionsWhenObjectsStopMoving = [
			() => {
				World.remove(world, allBodies.level2Platform1);
				World.remove(world, allBodies.level2Platform2);
				World.remove(world, allBodies.level2Stopper1);
				World.remove(world, allBodies.level2Stopper2);
			}
		]

		let staticObjects = arrayOfStaticObjectsPaths.map(
			(shapeObject) => {
				let vertices = shapeObject.points.split(" ").map((item) => {
					return {
						x: parseFloat(item.split(",")[0]),
						y: parseFloat(item.split(",")[1])
					}
				})
				let newX = shapeObject.width / 2 + shapeObject.x;
				let newY = shapeObject.height / 2 + shapeObject.y;
				let newBody = Bodies.fromVertices(newX, newY, vertices , {isStatic : true} );
				allBodies[shapeObject["name"]] = newBody;
				return newBody;
			}
		);

		let circlePostions = [
			[378.245, 19.745],
			[419.445, 19.745],
			[460.645, 19.745],
			[501.845, 19.745],
			[543.045, 19.745],
			[584.245, 19.745]
		]

		let allCirclesWidthHeight = 37.510;

		let arrayOfCircles = circlePostions.map((item) => {
			let newX = allCirclesWidthHeight / 2 + item[0];
			let newY = allCirclesWidthHeight / 2 + item[1];
			return Matter.Bodies.circle(newX, newY, allCirclesWidthHeight / 2);
		});


		let world = engine.world;

		// add all of the bodies to the world
		World.add(world, arrayOfCircles.concat(staticObjects));

		// run the engine
		Engine.run(engine);

		// run the renderer
		Render.run(render);

		setInterval(function(){ 
			let allStationary = true;
			arrayOfCircles.forEach(
				(item, idx) => {
					if (item.speed > 0.3) {
						allStationary = false;
					}
				}
			);
			if (allStationary) {
				actionsWhenObjectsStopMoving[currentIndexOfActionWhenBodiesStopMoving]();
				currentIndexOfActionWhenBodiesStopMoving += 1;
			}
		}, 1000);

	</script>
</body>
</html>